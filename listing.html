<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" type="image/x-icon" href="favicon_io/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="favicon_io/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon_io/favicon-16x16.png"><link rel="manifest" href="favicon_io/site.webmanifest">
    <title>Sell on Oda Pap</title>
    <link rel="stylesheet" href="listing.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
</head>
<body>
    <header class="oda-header">
        <div class="header-top-bar">
            <div class="header-logo" onclick="location.href='index.html'">
                <img src="images/logo.png" alt="Oda Pap" class="header-logo-img">
                <span class="header-logo-text">Oda Pap</span>
            </div>
        </div>
        <div class="header-divider"></div>
        <nav class="header-nav">
            <button class="header-nav-btn" onclick="location.href='index.html'"><i class="fas fa-home"></i></button>
            <button class="header-nav-btn" onclick="location.href='notification.html'"><i class="fas fa-bell"></i></button>
            <button class="header-nav-btn" onclick="location.href='profile.html'"><i class="fas fa-user-circle"></i></button>
        </nav>
    </header>

    <main class="main">
        <!-- Seller Card -->
        <div class="seller-card">
            <img id="profile-pic" src="images/default-profile.png" alt="">
            <div class="seller-info">
                <h3 id="seller-name">Seller</h3>
                <p id="seller-location"><i class="fas fa-map-marker-alt"></i> <span>Location</span></p>
            </div>
            <div class="stat"><span id="total-listings">0</span><small>Listings</small></div>
        </div>

        <!-- Profile Warning -->
        <div id="profile-warning" class="warning-banner" style="display:none;">
            <i class="fas fa-exclamation-circle"></i>
            <span>Complete your profile</span>
            <a href="profile.html">Go</a>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="new-listing"><i class="fas fa-plus-circle"></i> New</button>
            <button class="tab" data-tab="my-listings"><i class="fas fa-store"></i> My Listings</button>
        </div>

        <!-- NEW LISTING TAB -->
        <section class="tab-content active" id="new-listing">
            <!-- Progress Steps (Clickable + Swipeable) -->
            <div class="steps" id="steps">
                <div class="step active" data-step="1"><span>1</span><small>Product</small></div>
                <div class="step" data-step="2"><span>2</span><small>Category</small></div>
                <div class="step" data-step="3"><span>3</span><small>Pricing</small></div>
                <div class="step" data-step="4"><span>4</span><small>Review</small></div>
            </div>

            <!-- Context Pills (memory jogger on step 2+) -->
            <div class="context-pills" id="context-pills"></div>

            <!-- Swipeable Form -->
            <form id="listing-form" novalidate>
                <div class="form-wrapper" id="form-wrapper">
                    
                    <!-- STEP 1: Product -->
                    <div class="form-step" data-step="1">
                        <div class="form-card">
                            <h2><i class="fas fa-box-open"></i> What are you selling?</h2>
                            <p style="font-size: 0.8rem; color: #666; background: #fff8e1; padding: 10px; border-radius: 8px; margin-bottom: 15px;">
                                ðŸ’¡ <strong>Tip:</strong> Good photos and clear descriptions help you sell faster!
                            </p>
                            
                            <div class="field">
                                <label>Product Name <span class="req">*</span></label>
                                <p class="field-desc">What is the name of your product? Be specific and clear.</p>
                                <input type="text" id="product-name" placeholder="e.g., Cotton T-Shirts Bulk Pack" maxlength="150">
                                <small><span id="name-count">0</span>/150</small>
                            </div>

                            <div class="field">
                                <label>Photos <span class="req">*</span> <small>(max 5)</small></label>
                                <p class="field-desc">Add clear photos of your product. First photo will be the main image. Minimum 1 required.</p>
                                <div class="upload-area" id="upload-area">
                                    <input type="file" id="img-input" accept="image/jpeg,image/jpg,image/png,image/webp,image/heic" multiple hidden>
                                    <i class="fas fa-camera"></i>
                                    <span>Tap to add photos</span>
                                    <small>JPG, PNG, WebP or HEIC (max 2MB each)</small>
                                </div>
                                <div class="img-grid" id="img-grid"></div>
                            </div>

                            <div class="field">
                                <label>Description <span class="req">*</span></label>
                                <p class="field-desc">Describe your product - materials, sizes available, colors, features, etc.</p>
                                <textarea id="description" rows="4" placeholder="Example: High quality cotton t-shirts, available in sizes S-XXL. Material: 100% cotton. Colors: black, white, navy blue." maxlength="2000"></textarea>
                                <small><span id="desc-count">0</span>/2000</small>
                            </div>
                        </div>
                    </div>

                    <!-- STEP 2: Category -->
                    <div class="form-step" data-step="2">
                        <div class="form-card">
                            <h2><i class="fas fa-tags"></i> Category & Brand</h2>

                            <div class="field">
                                <label>Category <span class="req">*</span></label>
                                <p class="field-desc">Which category does your product belong to?</p>
                                <select id="category"><option value="">Select category</option></select>
                            </div>

                            <div class="field" id="sub-field" style="display:none;">
                                <label>Subcategory <span class="req">*</span></label>
                                <p class="field-desc">Choose the specific type within the category.</p>
                                <select id="subcategory"><option value="">Select subcategory</option></select>
                            </div>

                            <div class="field" id="type-field" style="display:none;">
                                <label>Product Type</label>
                                <p class="field-desc">Optional: Be more specific about what you're selling.</p>
                                <select id="product-type"><option value="">Select type (optional)</option></select>
                            </div>

                            <div class="field" id="custom-type-field" style="display:none;">
                                <label>Custom Type <span class="req">*</span></label>
                                <p class="field-desc">Enter a custom product type name.</p>
                                <input type="text" id="custom-type" placeholder="Enter your custom type">
                            </div>

                            <div class="field">
                                <label>Brand <span class="req">*</span></label>
                                <p class="field-desc">Select the brand of your product, or add a new one.</p>
                                <select id="brand"><option value="">Select brand</option></select>
                            </div>

                            <div class="field" id="custom-brand-field" style="display:none;">
                                <label>Brand Name <span class="req">*</span></label>
                                <p class="field-desc">Enter the brand name for your product.</p>
                                <input type="text" id="custom-brand" placeholder="Enter brand name">
                            </div>
                        </div>
                    </div>

                    <!-- STEP 3: Pricing -->
                    <div class="form-step" data-step="3">
                        <div class="form-card">
                            <h2><i class="fas fa-money-bill"></i> Pricing & Stock</h2>
                            <div class="pricing-help">
                                <p class="field-desc"><i class="fas fa-info-circle"></i> Add your product variants (like sizes or colors). Enter your <strong>wholesale price</strong> (what you sell for) and the <strong>retail price</strong> (shop price) to see the difference.</p>
                            </div>
                            <div id="variants-box"></div>
                            <button type="button" class="btn-outline" id="add-variant-btn"><i class="fas fa-plus"></i> Add Variant Type</button>

                            <details class="bulk-box" open>
                                <summary><i class="fas fa-layer-group"></i> Bulk Order Pricing</summary>
                                <div class="bulk-info-banner">
                                    <div class="bulk-info-icon"><i class="fas fa-truck-loading"></i></div>
                                    <div class="bulk-info-text">
                                        <strong>Attract more wholesale buyers!</strong>
                                        <span>Set quantity-based discounts to encourage larger orders.</span>
                                    </div>
                                </div>
                                <div class="bulk-tiers-header">
                                    <span>Minimum Quantity</span>
                                    <span>Discount</span>
                                    <span></span>
                                </div>
                                <div id="bulk-tiers"></div>
                                <button type="button" class="btn-add-tier" id="add-tier-btn">
                                    <i class="fas fa-plus-circle"></i> Add Bulk Tier
                                </button>
                                <div class="bulk-example">
                                    <p><i class="fas fa-lightbulb"></i> <strong>Example:</strong> 10+ units = 5% off, 50+ units = 10% off, 100+ units = 15% off</p>
                                </div>
                            </details>
                        </div>
                    </div>

                    <!-- STEP 4: Review -->
                    <div class="form-step" data-step="4">
                        <div class="form-card">
                            <h2><i class="fas fa-clipboard-check"></i> Review & Publish</h2>
                            <div id="review-box"></div>
                        </div>
                    </div>
                </div>

                <!-- Nav Buttons -->
                <div class="form-nav">
                    <button type="button" class="btn-back" id="btn-back"><i class="fas fa-chevron-left"></i></button>
                    <button type="button" class="btn-next" id="btn-next">Next <i class="fas fa-chevron-right"></i></button>
                    <button type="submit" class="btn-submit" id="btn-submit"><i class="fas fa-rocket"></i> Publish</button>
                </div>
            </form>
        </section>

        <!-- MY LISTINGS TAB -->
        <section class="tab-content" id="my-listings">
            <div class="list-header">
                <input type="text" id="search-list" placeholder="Search...">
                <div class="view-btns">
                    <button class="active" data-view="grid"><i class="fas fa-th"></i></button>
                    <button data-view="list"><i class="fas fa-list"></i></button>
                    <button data-view="table"><i class="fas fa-table"></i></button>
                </div>
            </div>
            <div id="listings-grid" class="listings-grid"></div>
            
            <!-- Excel-like Table View -->
            <div id="listings-table" class="listings-table" style="display:none;">
                <div class="table-toolbar">
                    <span class="table-info"><i class="fas fa-info-circle"></i> Click any cell to edit. Changes auto-save.</span>
                    <button class="btn-save-all" id="save-all-btn" style="display:none;"><i class="fas fa-save"></i> Save All</button>
                </div>
                <div class="table-scroll">
                    <table id="excel-table">
                        <thead>
                            <tr>
                                <th class="col-img">Images</th>
                                <th class="col-name">Name</th>
                                <th class="col-desc">Description</th>
                                <th class="col-var">Variations</th>
                                <th class="col-price">Price</th>
                                <th class="col-stock">Stock</th>
                                <th class="col-actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="excel-body"></tbody>
                    </table>
                </div>
            </div>
            
            <div id="empty-list" class="empty-box" style="display:none;">
                <i class="fas fa-box-open"></i>
                <p>No listings yet</p>
                <button class="btn-primary" onclick="switchTab('new-listing')">Create Listing</button>
            </div>
        </section>
    </main>

    <!-- Toast -->
    <div id="toast-box"></div>

    <!-- Loading -->
    <div id="loader" style="display:none;"><div class="spin"></div><p id="load-text">Loading...</p></div>

    <!-- Image Editor -->
    <div id="editor-modal" class="modal">
        <div class="editor-head"><span>Edit Photo</span><button onclick="closeEditor()"><i class="fas fa-times"></i></button></div>
        <div class="editor-body"><img id="edit-img" src=""></div>
        <div class="editor-tools">
            <button onclick="rotateImg(-90)"><i class="fas fa-undo"></i></button>
            <button onclick="rotateImg(90)"><i class="fas fa-redo"></i></button>
            <button onclick="flipImg('h')"><i class="fas fa-arrows-alt-h"></i></button>
            <button onclick="flipImg('v')"><i class="fas fa-arrows-alt-v"></i></button>
        </div>
        <div class="editor-btns">
            <button class="btn-cancel" onclick="closeEditor()">Cancel</button>
            <button class="btn-primary" onclick="applyEdit()">Apply</button>
        </div>
    </div>

    <!-- Confirm -->
    <div id="confirm-modal" class="modal">
        <div class="confirm-box">
            <div class="confirm-icon"><i class="fas fa-trash-alt"></i></div>
            <h3 id="confirm-title">Delete?</h3>
            <p id="confirm-msg">This cannot be undone.</p>
            <div class="confirm-btns">
                <button class="btn-cancel" onclick="hideConfirm()">Cancel</button>
                <button class="btn-danger" id="confirm-yes">Delete</button>
            </div>
        </div>
    </div>

    <!-- Variation Editor Modal -->
    <div id="var-editor-modal" class="modal">
        <div class="modal-content var-editor-content-wrap">
            <div class="modal-header">
                <h3><i class="fas fa-layer-group"></i> Edit Variations</h3>
                <button class="modal-close-btn" onclick="closeVariationEditor()"><i class="fas fa-times"></i></button>
            </div>
            <div class="var-editor-body" id="var-editor-content">
                <!-- Dynamically populated -->
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeVariationEditor()">Cancel</button>
                <button class="btn-primary" onclick="saveVariationEditor()"><i class="fas fa-save"></i> Save Variations</button>
            </div>
        </div>
    </div>

    <!-- Image Manager Modal (for My Listings) -->
    <div id="image-manager-modal" class="modal">
        <div class="modal-content image-manager-content">
            <div class="modal-header">
                <h3><i class="fas fa-images"></i> Manage Images</h3>
                <button class="modal-close-btn" onclick="closeImageManager()"><i class="fas fa-times"></i></button>
            </div>
            <div class="image-manager-body">
                <p class="field-desc">Add, remove, or reorder images. Minimum 1 image required.</p>
                <div class="image-manager-grid" id="manage-images-grid"></div>
                <div class="image-manager-add" id="add-more-images">
                    <input type="file" id="manage-img-input" accept="image/*" multiple hidden>
                    <button type="button" class="btn-add-img" onclick="document.getElementById('manage-img-input').click()">
                        <i class="fas fa-plus"></i> Add Images
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" onclick="closeImageManager()">Cancel</button>
                <button class="btn-primary" id="save-images-btn" onclick="saveListingImages()"><i class="fas fa-save"></i> Save Images</button>
            </div>
        </div>
    </div>

    <!-- Draft -->
    <div id="draft-modal" class="modal">
        <div class="confirm-box">
            <div class="confirm-icon info"><i class="fas fa-file-alt"></i></div>
            <h3>Resume Draft?</h3>
            <p id="draft-msg">Continue where you left off?</p>
            <div class="confirm-btns">
                <button class="btn-cancel" id="draft-no">Start Fresh</button>
                <button class="btn-primary" id="draft-yes">Continue</button>
            </div>
        </div>
    </div>

    <!-- Complete Profile Modal (inline on listing page) -->
    <div id="profile-modal" class="modal">
        <div class="modal-content" style="max-width:420px;width:100%;">
            <div class="modal-header">
                <h3><i class="fas fa-user-edit"></i> Complete Your Profile</h3>
                <button class="modal-close-btn" id="close-profile-modal"><i class="fas fa-times"></i></button>
            </div>
            <div style="padding:16px;">
                <p style="font-size:0.82rem;color:#666;margin-bottom:14px;">Fill in the details below to start selling. This only takes a moment!</p>
                <div style="margin-bottom:12px;">
                    <label style="font-size:0.75rem;color:#444;font-weight:600;display:block;margin-bottom:4px;">Full Name <span style="color:#e53e3e;">*</span></label>
                    <input type="text" id="lp-name" placeholder="Your full name" maxlength="80" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:0.85rem;">
                </div>
                <div style="margin-bottom:12px;">
                    <label style="font-size:0.75rem;color:#444;font-weight:600;display:block;margin-bottom:4px;">Phone Number <span style="color:#e53e3e;">*</span></label>
                    <input type="tel" id="lp-phone" placeholder="e.g. 0712345678" maxlength="15" style="width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;font-size:0.85rem;">
                </div>
                <div style="margin-bottom:8px;">
                    <label style="font-size:0.75rem;color:#444;font-weight:600;display:block;margin-bottom:4px;">Location <span style="color:#e53e3e;">*</span></label>
                    <button type="button" id="lp-detect-btn" style="width:100%;padding:9px;background:linear-gradient(135deg,#1a73e8,#4285f4);color:white;border:none;border-radius:8px;font-size:0.8rem;font-weight:600;cursor:pointer;margin-bottom:8px;display:flex;align-items:center;justify-content:center;gap:7px;">
                      <i class="fas fa-crosshairs"></i> Detect My Location
                    </button>
                    <div id="lp-detect-status" style="display:none;font-size:0.73rem;padding:7px 10px;border-radius:6px;margin-bottom:6px;"></div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;">
                        <select id="lp-region" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;font-size:0.8rem;"><option value="">Region</option></select>
                        <select id="lp-county" disabled style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;font-size:0.8rem;"><option value="">County</option></select>
                        <select id="lp-constituency" disabled style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;font-size:0.8rem;"><option value="">Sub-County</option></select>
                        <select id="lp-ward" disabled style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;font-size:0.8rem;"><option value="">Ward</option></select>
                    </div>
                </div>
                <div style="margin-bottom:12px;">
                    <label style="font-size:0.75rem;color:#444;font-weight:600;display:block;margin-bottom:4px;">Specific Location / Landmark</label>
                    <textarea id="lp-specific" rows="2" placeholder="e.g., Near Tuskys, 2nd floor" style="width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;font-size:0.8rem;"></textarea>
                </div>
                <!-- Optional Map -->
                <div style="margin-bottom:12px;">
                    <button type="button" id="listing-map-toggle" style="background:none;border:1px dashed #aaa;border-radius:6px;padding:6px 12px;color:#555;font-size:0.75rem;cursor:pointer;">
                        <i class="fas fa-map-marked-alt"></i> Pin on Map (optional)
                    </button>
                    <div id="listing-map-container" style="display:none;margin-top:8px;border-radius:10px;overflow:hidden;border:1px solid #ddd;">
                        <div id="listing-map" style="width:100%;height:200px;"></div>
                        <p style="text-align:center;font-size:0.7rem;color:#888;padding:5px;background:#fafafa;"><i class="fas fa-info-circle"></i> Tap the map to pin your location</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer" style="padding:0 16px 16px;">
                <button class="btn-cancel" id="cancel-profile-modal">Cancel</button>
                <button class="btn-primary" id="save-profile-modal"><i class="fas fa-check"></i> Save & Continue</button>
            </div>
        </div>
    </div>

    <script type="module" src="listing.js"></script>
</body>
</html>
