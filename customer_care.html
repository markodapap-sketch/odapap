<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KRSVFTQZK4"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-KRSVFTQZK4');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="favicon_io/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="favicon_io/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon_io/favicon-16x16.png"><link rel="manifest" href="favicon_io/site.webmanifest">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon_io/apple-touch-icon.png">
    <title>Customer Care - Oda Pap</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <header class="oda-header">
        <div class="header-top-bar">
            <div class="header-logo" onclick="location.href='index.html'">
                <img src="images/logo.png" alt="Oda Pap" class="header-logo-img">
                <span class="header-logo-text">Oda Pap</span>
            </div>
            <button onclick="window.history.back()" class="header-back-btn">
                <i class="fas fa-arrow-left"></i> Back
            </button>
        </div>
        <div class="header-divider"></div>
        <nav class="header-nav">
            <button class="header-nav-btn" onclick="location.href='index.html'"><i class="fas fa-home"></i></button>
            <button class="header-nav-btn" onclick="location.href='notification.html'"><i class="fas fa-bell"></i></button>
            <button class="header-nav-btn" onclick="location.href='profile.html'"><i class="fas fa-user-circle"></i></button>
        </nav>
    </header>

    <main>
        <div class="page-header">
            <h1><i class="fas fa-headset"></i> Customer Care</h1>
            <p>We're here to help</p>
            <p style="font-size: 0.75rem; color: #666; margin-top: 6px;">ðŸ“ž Need help? Chat with us, call, or check the FAQs below for quick answers!</p>
        </div>

        <div class="customer-care-container">
            <!-- Contact Options -->
            <section class="contact-section">
                <h2>Get in Touch</h2>
                <div class="contact-options">
                    <div class="contact-card">
                        <i class="fas fa-comments"></i>
                        <h3>Chat with Support</h3>
                        <p>Message our support team directly</p>
                        <button id="chatWithSupportBtn" class="btn-contact">
                            <i class="fas fa-paper-plane"></i> Start Chat
                        </button>
                    </div>
                    <div class="contact-card">
                        <i class="fas fa-envelope"></i>
                        <h3>Email Us</h3>
                        <p class="copyable-text" onclick="copyToClipboard('admin@odapap.com', this)">
                            admin@odapap.com
                            <i class="fas fa-copy copy-icon"></i>
                        </p>
                        <a href="mailto:admin@odapap.com" class="btn-contact">
                            <i class="fas fa-envelope"></i> Send Email
                        </a>
                    </div>
                    <div class="contact-card">
                        <i class="fas fa-phone"></i>
                        <h3>Call Us</h3>
                        <p class="copyable-text" onclick="copyToClipboard('0751400299', this)">
                            0751400299
                            <i class="fas fa-copy copy-icon"></i>
                        </p>
                        <a href="tel:+254751400299" class="btn-contact">
                            <i class="fas fa-phone"></i> Call Now
                        </a>
                    </div>
                </div>
            </section>

            <!-- WhatsApp Quick Contact -->
            <section class="whatsapp-section">
                <a href="https://wa.me/254751400299" target="_blank" class="whatsapp-btn">
                    <i class="fab fa-whatsapp"></i> Chat on WhatsApp
                </a>
            </section>

            <!-- FAQs Section -->
            <section class="faq-section">
                <h2>Frequently Asked Questions</h2>
                <div class="faq-list">
                    <!-- FAQs will be dynamically inserted here -->
                </div>
            </section>
        </div>
    </main>

    <footer>
        <p>&copy; 2026 Oda Pap. All Rights Reserved.</p>
    </footer>

    <script type="module">
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs, limit } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { app } from "./js/firebase.js";

        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Admin support email - used to find admin user ID
        const ADMIN_EMAIL = 'admin@odapap.com';
        let adminUserId = null;

        // Fetch admin user ID by email
        async function getAdminUserId() {
            try {
                const usersRef = collection(db, 'Users');
                const q = query(usersRef, where('email', '==', ADMIN_EMAIL), limit(1));
                const snapshot = await getDocs(q);
                
                if (!snapshot.empty) {
                    adminUserId = snapshot.docs[0].id;
                    return adminUserId;
                }
            } catch (error) {
                console.error('Error fetching admin user:', error);
            }
            return null;
        }

        // Copy to clipboard function
        window.copyToClipboard = function(text, element) {
            navigator.clipboard.writeText(text).then(() => {
                // Show copied feedback
                const originalHTML = element.innerHTML;
                element.innerHTML = `<i class="fas fa-check"></i> Copied!`;
                element.style.color = '#4caf50';
                
                setTimeout(() => {
                    element.innerHTML = originalHTML;
                    element.style.color = '';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
            });
        };

        // FAQs Data - Updated with accurate information
        const faqs = [
            {
                question: "How do I place an order?",
                answer: "Browse our products, select an item, choose your quantity, and proceed to checkout. You can pay using M-Pesa (instant payment via STK Push), pay on delivery, or use your Oda Pap wallet balance."
            },
            {
                question: "What is your return policy?",
                answer: "We offer returns within 7 days of purchase for items in original condition. Contact us at admin@odapap.com or call 0751400299 to initiate a return."
            },
            {
                question: "How long does shipping take?",
                answer: "We currently deliver within Mombasa County. Standard delivery takes 1-2 business days. Delivery to other areas is coming soon!"
            },
            {
                question: "Can I cancel my order?",
                answer: "Orders can be cancelled within 2 hours of placement before dispatch. Contact us immediately at 0751400299 or email admin@odapap.com to cancel."
            },
            {
                question: "What payment methods do you accept?",
                answer: "We accept M-Pesa (recommended - instant payment via STK Push), Oda Pap Wallet balance, and Pay on Delivery for orders within Mombasa."
            },
            {
                question: "How do I track my order?",
                answer: "Go to Order Tracking in your profile to monitor your delivery status in real-time. You'll also receive notifications for each status update."
            },
            {
                question: "Are there any delivery charges?",
                answer: "Delivery charges depend on your location within Mombasa. Fees typically range from KES 100-300 based on your subcounty and ward."
            },
            {
                question: "What should I do if I receive a damaged item?",
                answer: "Contact us immediately at admin@odapap.com or call 0751400299 with photos of the damaged item. We'll arrange a replacement or full refund within 24 hours."
            },
            {
                question: "How do I deposit money to my wallet?",
                answer: "Go to Deposit in your profile. Enter the amount and your M-Pesa number, then complete the payment. Funds are credited instantly after successful payment."
            },
            {
                question: "How do I become a seller on Oda Pap?",
                answer: "Visit the Seller Registration page or contact us at admin@odapap.com to apply. Complete verification and start listing your products. We support both B2B wholesale and retail sellers."
            },
            {
                question: "What is the minimum order quantity?",
                answer: "Minimum order quantities vary by product. Each product page displays the minimum order requirement. This is especially important for wholesale/B2B orders."
            },
            {
                question: "How do I contact customer support?",
                answer: "You can reach us via: Email: admin@odapap.com, Phone: 0751400299, WhatsApp: +254751400299, or use the in-app chat feature to message us directly."
            }
        ];

        // Display FAQs
        function displayFAQs() {
            const faqList = document.querySelector('.faq-list');
            faqList.innerHTML = '';

            faqs.forEach((faq, index) => {
                const faqItem = document.createElement('div');
                faqItem.className = 'faq-item';
                faqItem.innerHTML = `
                    <div class="faq-question" onclick="toggleFAQ(${index}, event)">
                        <h3>${faq.question}</h3>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer" id="answer-${index}" style="display: none;">
                        <p>${faq.answer}</p>
                    </div>
                `;
                faqList.appendChild(faqItem);
            });
        }

        // Toggle FAQ answer
        window.toggleFAQ = function(index, e) {
            const answer = document.getElementById(`answer-${index}`);
            const question = e.target.closest('.faq-question');
            const isOpen = answer.style.display === 'block';
            
            // Close all other FAQs
            document.querySelectorAll('.faq-answer').forEach(a => a.style.display = 'none');
            document.querySelectorAll('.faq-question i').forEach(i => i.classList.remove('open'));
            
            // Open current FAQ
            if (!isOpen) {
                answer.style.display = 'block';
                question.querySelector('i').classList.add('open');
            }
        };

        // Chat with support button
        document.getElementById('chatWithSupportBtn').addEventListener('click', async () => {
            const user = auth.currentUser;
            if (user) {
                // Get admin user ID by email lookup
                let supportId = adminUserId || await getAdminUserId();
                
                // Fallback to hardcoded ID if lookup fails
                if (!supportId) {
                    supportId = 'nYaKUGTsLTf3d4wYWNezHv2sVbT2'; // Fallback support ID
                }
                
                window.location.href = `chat.html?sellerId=${supportId}`;
            } else {
                // Show login modal
                const overlay = document.createElement('div');
                overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:9999;display:flex;align-items:center;justify-content:center;';
                overlay.addEventListener('click', (e) => { if (e.target === overlay) overlay.remove(); });
                
                const box = document.createElement('div');
                box.style.cssText = 'background:white;padding:24px;border-radius:16px;max-width:320px;text-align:center;';
                box.innerHTML = `
                    <i class="fas fa-user-lock" style="font-size:48px;color:#ff5722;margin-bottom:16px;"></i>
                    <h3 style="margin:0 0 8px;color:#333;">Login Required</h3>
                    <p style="color:#666;font-size:14px;margin:0 0 20px;">Please log in to chat with support</p>
                    <div style="display:flex;gap:12px;"></div>
                `;
                const btnRow = box.querySelector('div');
                const cancelBtn = document.createElement('button');
                cancelBtn.textContent = 'Cancel';
                cancelBtn.style.cssText = 'flex:1;padding:12px;border:1px solid #ddd;background:white;border-radius:8px;cursor:pointer;';
                cancelBtn.addEventListener('click', () => overlay.remove());
                const loginBtn = document.createElement('button');
                loginBtn.textContent = 'Login';
                loginBtn.style.cssText = 'flex:1;padding:12px;border:none;background:#ff5722;color:white;border-radius:8px;cursor:pointer;';
                loginBtn.addEventListener('click', () => { window.location.href = 'login.html?redirect=customer_care.html'; });
                btnRow.appendChild(cancelBtn);
                btnRow.appendChild(loginBtn);
                overlay.appendChild(box);
                document.body.appendChild(overlay);
            }
        });

        // Load FAQs on page load and pre-fetch admin ID
        window.addEventListener('load', async () => {
            displayFAQs();
            await getAdminUserId();
        });
    </script>

    <style>
        .page-header {
            text-align: center;
            padding: 30px 20px;
            background: linear-gradient(135deg, #ff5722 0%, #ff7043 100%);
            color: white;
            margin-bottom: 30px;
        }

        .page-header h1 {
            margin: 0 0 10px 0;
            font-size: 28px;
        }

        .page-header p {
            margin: 0;
            opacity: 0.9;
        }

        .customer-care-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px 40px;
        }

        .contact-section {
            margin-bottom: 40px;
        }

        .contact-section h2 {
            color: #212121;
            margin-bottom: 24px;
            font-size: 22px;
        }

        .contact-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .contact-card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }

        .contact-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }

        .contact-card > i:first-child {
            font-size: 48px;
            color: #ff5722;
            margin-bottom: 16px;
            display: block;
        }

        .contact-card h3 {
            color: #212121;
            margin: 0 0 8px 0;
            font-size: 18px;
        }

        .contact-card p {
            color: #757575;
            margin: 0 0 20px 0;
            font-size: 14px;
        }

        .copyable-text {
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #f5f5f5;
            border-radius: 8px;
            font-weight: 600;
            color: #212121 !important;
            transition: all 0.3s ease;
            font-size: 16px !important;
        }

        .copyable-text:hover {
            background: #e8e8e8;
        }

        .copyable-text .copy-icon {
            font-size: 14px;
            color: #757575;
        }

        .whatsapp-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .whatsapp-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: #25D366;
            color: white;
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }

        .whatsapp-btn:hover {
            background: #128C7E;
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
        }

        .whatsapp-btn i {
            font-size: 24px;
        }

        .whatsapp-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .whatsapp-btn {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: #25D366;
            color: white;
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }

        .whatsapp-btn:hover {
            background: #128C7E;
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
        }

        .whatsapp-btn i {
            font-size: 24px;
        }

        .contact-card > i {
            font-size: 48px;
            color: #ff5722;
            margin-bottom: 16px;
            display: block;
        }

        .btn-contact {
            display: inline-block;
            background: #ff5722;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 0 auto;
        }

        .btn-contact:hover {
            background: #e64a19;
            transform: scale(1.05);
        }

        .faq-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        .faq-section h2 {
            color: #212121;
            margin: 0 0 24px 0;
            font-size: 22px;
        }

        .faq-list {
            display: grid;
            gap: 12px;
        }

        .faq-item {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }

        .faq-question {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: #fafafa;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .faq-question:hover {
            background: #f5f5f5;
        }

        .faq-question h3 {
            margin: 0;
            color: #212121;
            font-size: 15px;
            flex: 1;
            text-align: left;
        }

        .faq-question i {
            color: #ff5722;
            transition: transform 0.3s ease;
            margin-left: 12px;
        }

        .faq-question i.open {
            transform: rotate(180deg);
        }

        .faq-answer {
            padding: 16px;
            background: white;
            border-top: 1px solid #e0e0e0;
        }

        .faq-answer p {
            margin: 0;
            color: #424242;
            line-height: 1.6;
        }

        @media (max-width: 600px) {
            .contact-options {
                grid-template-columns: 1fr;
            }

            .faq-section {
                padding: 20px;
            }
        }
    </style>
</body>
</html>
